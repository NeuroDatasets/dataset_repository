<!DOCTYPE html>
<html>
<head>
  <title>Dataset Search</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js"></script>
  <style>
    .description {
      font-size: smaller;
    }
    .metadata {
      font-style: italic;
      color: gray;
    }  
  </style> 
</head>
<body>
  <input type="text" id="search-input" oninput="search()"> 
  <div id="results"></div>

  <script>
    var idx; 
    var datasets; 

    fetch('datasets.json').then(function(response) {
      return response.json();
    }).then(function(data) {
      datasets = data;
      idx = lunr(function() {
        this.ref('id');
        this.field('species');
        this.field('type');
        this.field('state');
        this.field('area'); // Search within the area array
        this.field('keywords'); // Add keywords field 
      });

      datasets.forEach(function(doc) {
        this.add(doc);
      }, this);
    });

    function search() {
      var query = document.getElementById('search-input').value;
      var results = idx.search(query);
      var resultData = results.map(function(result) {
        return datasets.find(dataset => dataset.id === result.ref);
      });
      
      var resultsHTML = resultData.map(function(dataset) {
        return `<li>
                  <a href="${dataset.link}" target="_blank">${dataset.name}</a>
                  <p class="description">${dataset.description.slice(0, 100)}...</p> 
                  <p class="metadata">Species: ${dataset.species} | Type: ${dataset.type}</p>
                </li>`; 
      }).join('');
      document.getElementById('results').innerHTML = `<ul>${resultsHTML}</ul>`;
    }
  </script>
</body>
</html>
